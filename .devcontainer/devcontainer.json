import streamlit as st
import torch
import torch.nn as nn

# ---------------------------------------------------
# PyTorch Model
# ---------------------------------------------------
class HouseModel(nn.Module):
    def __init__(self):
        super().__init__()
        self.net = nn.Sequential(
            nn.Linear(2, 16),
            nn.ReLU(),
            nn.Linear(16, 8),
            nn.ReLU(),
            nn.Linear(8, 1)
        )

    def forward(self, x):
        return self.net(x)

@st.cache_resource
def load_model():
    model = HouseModel()
    model.load_state_dict(torch.load("house_model.pt", map_location="cpu"))
    model.eval()
    return model

model = load_model()

# ---------------------------------------------------
# Page Config
# ---------------------------------------------------
st.set_page_config(page_title="House Value Estimator", layout="wide")

# ---------------------------------------------------
# Sidebar Inputs (New UI)
# ---------------------------------------------------
st.sidebar.header("üìå Property Details")

sqft = st.sidebar.slider("Total Area (sqft)", 400, 6000, 1200)
bhk = st.sidebar.selectbox("Number of Bedrooms (BHK)", [1, 2, 3, 4, 5])
location = st.sidebar.selectbox("Location", ["Bangalore", "Hyderabad", "Chennai", "Mumbai", "Pune"])
age = st.sidebar.number_input("Age of House (Years)", 0, 30, 5)
furnished = st.sidebar.radio("Furnishing Status", ["Furnished", "Semi-Furnished", "Unfurnished"])
balcony = st.sidebar.selectbox("Balconies", [0, 1, 2, 3])
parking = st.sidebar.selectbox("Parking Available", ["Yes", "No"])

st.sidebar.write("---")
predict_btn = st.sidebar.button("üîç Estimate Price")


# ---------------------------------------------------
# Main Layout - New Modern Look
# ---------------------------------------------------
st.title("üè† House Value Estimator")
st.write("A modern app to estimate house prices using a PyTorch ML model.")

col1, col2 = st.columns(2)

with col1:
    st.subheader("üìÑ Submitted Details")
    st.write(f"**Location:** {location}")
    st.write(f"**Area:** {sqft} sqft")
    st.write(f"**BHK:** {bhk}")
    st.write(f"**Age:** {age} years")
    st.write(f"**Furnishing:** {furnished}")
    st.write(f"**Balconies:** {balcony}")
    st.write(f"**Parking:** {parking}")

with col2:
    st.subheader("üí∞ Estimated Price")
    if predict_btn:
        x = torch.tensor([[sqft, bhk]], dtype=torch.float32)
        predicted_value = model(x).item()
        final_price = predicted_value * 5000

        st.success(f"### ‚Çπ {final_price:,.2f}")
    else:
        st.info("Click **Estimate Price** to see the prediction.")


# ---------------------------------------------------
# Footer
# ---------------------------------------------------
st.write("---")
st.caption("‚ú® Designed with Streamlit | ML Model: PyTorch")
